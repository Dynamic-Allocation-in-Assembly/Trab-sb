int brk; //brk atual mantido
int base_brk; //endereço inicial da heap:

void setup_brk() {
	base_brk = sys_brk(0); //sys_brk(0) = endereço atual de brk;
	brk = base_brk;
}

void dismiss_brk() {
	sys_brk(base_brk);
	brk = base_brk;
}

void *memory_alloc(unsigned lon int y) {
	melhor = NULL;
	melhor_tam = 0;

	p = base_brk;
	while (p < brk) {
		uso = [p]
		tam = (*ulong)*(p+1);

		if (uso == 0 && tam >= y) {
			if (tam > melhor_tam) {
				melhor = p;
				melhor_tam = tam;
			}
		}
		p += 9 + tam;
	}

	//SE ACHOU UM BLOCO NO MEIO POSSÍVEL PARA SE COLOCAR:
	if (melhor != NULL) {
		if (melhor_tam >= y + 9 + 1) {
			[melhor] = 1;
			*(ulong*)(melhor+1) = y;

			novo_bloco = melhor+9+y;
			[novo] = 0;
			*(ulong*)(novo+1) = melhor_tam - 9 - y;
		}
		else {
			[melhor] = 1;
			*(ulong*)(melhor+1) = y;
		}

		return melhor+9;
	}

	//NAO ACHOU BLOCO NO MEIO:
	brk += [brk-8] + 9;
	[brk-9] = 1;
	[brk-8] = y;

	return brk;
}

int memory_free(void *pointer) {
	unsigned char *p = (unsigned char *)pointer - 9;

	*p = 0;

	return 0;
}









